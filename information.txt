# تفاصيل دقيقة لنظام إدارة العيادة

هذا المستند يوفر شرحاً مفصلاً للتطبيق، ميزاته، هيكلته، أنواع البيانات المستخدمة، وأنواع المستخدمين وصلاحياتهم.

---

## 1. نظرة عامة على التطبيق

**اسم التطبيق:** نظام إدارة العيادة (Sara dental clinic)

**الوصف:**
هو تطبيق ويب شامل مصمم لإدارة عمليات العيادات الطبية بفعالية. يتيح النظام إدارة ملفات المرضى، المواعيد، خطط العلاج، المدفوعات، والمستخدمين (مدير، طبيب، سكرتير، مدير فرعي).
يتميز التطبيق بتصميم عصري ومتجاوب (Mobile-First)، ويدعم العمل دون اتصال بالإنترنت مع مزامنة البيانات تلقائياً عند عودة الاتصال، كما أنه قابل للتثبيت على الأجهزة (PWA).

---

## 2. أنواع المستخدمين وصلاحياتهم

يحتوي النظام على أربعة أنواع من المستخدمين، لكل منهم صلاحيات محددة:

### أ. مدير (Admin)
- يمتلك كافة الصلاحيات في النظام.
- **الوصول:** لوحة التحكم، المستخدمين (إدارة الأطباء، السكرتارية، المدراء الفرعيين)، المرضى، المواعيد، المدفوعات، الإحصائيات، الملف الشخصي (إدارة إعدادات العلاج العامة)، الدعم، أرشيف الأحداث.

### ب. مدير فرعي (Sub-Manager)
- يمتلك صلاحيات مشابهة للمدير ولكن لا يمكنه إدارة المدراء الآخرين.
- **الوصول:** لوحة التحكم، المستخدمين (إدارة الأطباء، السكرتارية)، المرضى، المواعيد، المدفوعات، الإحصائيات، الملف الشخصي (إدارة إعدادات العلاج العامة)، الدعم، أرشيف الأحداث.

### ج. طبيب (Doctor)
- يركز على الجوانب الطبية للمرضى المرتبطين به.
- **الوصول:** لوحة التحكم، مرضاي (قائمة المرضى الخاصة به فقط)، الملف الشخصي (لإدارة جدول عمله الأسبوعي)، الدعم.

### د. سكرتير (Secretary)
- مسؤول عن المهام الإدارية والتنظيمية.
- **الوصول:** لوحة التحكم، المرضى، المواعيد، المدفوعات، الملف الشخصي، الدعم.

---

## 3. ميزات التطبيق الرئيسية

- **إدارة المستخدمين:** إضافة، تعديل، وحذف الأطباء، السكرتارية، والمدراء.
- **إدارة المرضى:** إنشاء ملفات كاملة، بحث متقدم وفلترة، عرض تفصيلي.
- **إدارة الجلسات وخطط العلاج:** إنشاء جلسات، إضافة علاجات لكل جلسة، ووضع خطط علاجية مستقبلية.
- **إدارة المواعيد:** نظام حجز متكامل مع عرض الأوقات المتاحة لكل طبيب.
- **الإدارة المالية:** تسجيل المدفوعات وعرض ملخص مالي لكل مريض.
- **إعدادات العلاج:** إدارة أنواع العلاجات وأسعارها الأساسية.
- **إحصائيات وتقارير:** لوحة تحكم سريعة، صفحة إحصائيات متقدمة، طباعة تقارير شاملة للمرضى.
- **إدارة جدول الأطباء:** يمكن للأطباء تحديد أيام وساعات عملهم.
- **معرض صور المرضى:** رفع صور خاصة بكل مريض مع تعليقات وتواريخ.
- **سجل النشاط وأرشيف الأحداث:** تتبع جميع الإجراءات على ملفات المرضى.
- **دعم العمل دون اتصال (Offline Support):** مزامنة البيانات تلقائياً عند عودة الاتصال.
- **تطبيق ويب تقدمي (PWA):** قابل للتثبيت على الأجهزة.
- **دعم الوضع المظلم (Dark Mode).**
- **تأثيرات صوتية عند اللمس** لتعزيز تجربة المستخدم على الأجهزة المحمولة.

---

## 4. هيكلة المجلدات والملفات

```
/
├── public/
│   ├── assets/
│   │   ├── favicon-96x96.png
│   │   ├── favicon.svg
│   │   ├── apple-touch-icon.png
│   │   ├── index-DfLSz_m_.js
│   │   └── logo.png
│   ├── manifest.json
│   ├── service-worker.js
│   └── vite.svg
├── src/
│   ├── components/
│   │   ├── dashboards/
│   │   │   ├── DashboardAdmin.tsx
│   │   │   ├── DashboardDoctor.tsx
│   │   │   └── DashboardSecretary.tsx
│   │   ├── layout/
│   │   │   ├── Layout.tsx
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── BottomNav.tsx
│   │   ├── users/
│   │   │   ├── DoctorsTab.tsx
│   │   │   ├── SecretariesTab.tsx
│   │   │   └── AdminsTab.tsx
│   │   ├── Icons.tsx
│   │   ├── LoadingSpinner.tsx
│   │   └── ThemeToggleButton.tsx
│   ├── hooks/
│   │   ├── useAuth.ts
│   │   ├── useTheme.ts
│   │   └── useAppSettings.ts
│   ├── pages/
│   │   ├── LoginPage.tsx
│   │   ├── DashboardPage.tsx
│   │   ├── PatientsPage.tsx
│   │   ├── UsersPage.tsx
│   │   ├── AppointmentsPage.tsx
│   │   ├── PaymentsPage.tsx
│   │   ├── DoctorSchedulePage.tsx
│   │   ├── StatisticsPage.tsx
│   │   ├── ProfilePage.tsx
│   │   ├── PatientSessionsPage.tsx
│   │   ├── PatientPlanPage.tsx
│   │   ├── PatientDetailsPage.tsx
│   │   ├── PatientFinancialPage.tsx
│   │   ├── PatientPhotosPage.tsx
│   │   ├── PatientActivityLogPage.tsx
│   │   ├── ContactPage.tsx
│   │   ├── TreatmentsSettingsPage.tsx
│   │   └── ActivityArchivesPage.tsx
│   ├── services/
│   │   ├── api.ts
│   │   ├── db.ts
│   │   ├── sync.ts
│   │   └── touchSound.ts
│   ├── App.tsx
│   ├── appSettings.ts
│   ├── constants.tsx
│   ├── index.css
│   ├── index.tsx
│   └── types.ts
├── .eslintrc.cjs
├── index.html
├── package.json
├── tailwind.config.js
├── information.txt
└── ... (ملفات إعدادات أخرى)
```

---

## 5. وصف المكونات والصفحات

### 5.1 مكونات التخطيط العام (Layout Components - `src/components/layout/`)
- **`Layout.tsx`:** المكون الأب الذي يجمع أجزاء الواجهة. يحتوي على الشريط الجانبي، الرأسية، والشريط السفلي، ويعرض الصفحة الحالية بداخلها.
- **`Header.tsx`:** الشريط العلوي. يحتوي على اسم الصفحة الحالية، زر فتح الشريط الجانبي (للموبايل)، زر تحديث البيانات، وزر تبديل الوضع المظلم.
- **`Sidebar.tsx`:** الشريط الجانبي. يعرض قائمة التنقل بناءً على دور المستخدم، اسم التطبيق وشعاره، وإصدار التطبيق. كما يحتوي على زر لتفعيل/إيقاف إشعارات المتصفح (Push Notifications).
- **`BottomNav.tsx`:** شريط التنقل السفلي الذي يظهر في نسخة الموبايل لسهولة الوصول.

### 5.2 الصفحات الرئيسية (Main Pages - `src/pages/`)
- **`LoginPage.tsx`:** صفحة تسجيل الدخول مع نموذج لإدخال البريد الإلكتروني وكلمة المرور.
- **`DashboardPage.tsx`:** تعمل كموجه، حيث تعرض لوحة التحكم المناسبة بناءً على دور المستخدم المسجل دخوله.
- **`UsersPage.tsx`:** صفحة لإدارة المستخدمين تحتوي على تبويبات:
    - **`DoctorsTab.tsx`:** لإدارة الأطباء (إضافة/تعديل/حذف).
    - **`SecretariesTab.tsx`:** لإدارة السكرتارية.
    - **`AdminsTab.tsx`:** لإدارة المدراء (الأساسيون والفرعيون).
- **`PatientsPage.tsx`:** قلب النظام، تعرض قائمة بالمرضى مع بطاقات تفاعلية. تتيح البحث، الفلترة، وإضافة مريض جديد. كل بطاقة مريض تحتوي على أزرار للانتقال إلى صفحاته الفرعية.
- **`AppointmentsPage.tsx`:** تعرض جدول المواعيد مع فلاتر زمنية وتتيح إضافة وتعديل وحذف المواعيد.
- **`PaymentsPage.tsx`:** سجل لجميع المدفوعات المالية في العيادة مع إمكانية البحث والإضافة والتعديل.
- **`StatisticsPage.tsx`:** صفحة لعرض إحصائيات مالية شاملة للعيادة مع إمكانية تحديد نطاق زمني.
- **`ProfilePage.tsx`:** صفحة الملف الشخصي. تعرض معلومات المستخدم وتسمح له بتسجيل الخروج. للأدوار الإدارية، تعرض قسم إعدادات العلاجات العامة. للأطباء، تعرض قسم إدارة جدول العمل.
- **`ContactPage.tsx`:** صفحة تعرض معلومات التواصل مع فريق تطوير التطبيق.
- **`ActivityArchivesPage.tsx`:** صفحة لعرض سجل كامل لجميع الأنشطة التي تمت في النظام مع إمكانية الفلترة حسب التاريخ.

### 5.3 الصفحات الفرعية للمريض (Patient Sub-Pages)
- **`PatientSessionsPage.tsx`:** تعرض قائمة بجميع جلسات المريض. يمكن من خلالها إضافة جلسة جديدة أو الدخول إلى جلسة موجودة لعرض وإدارة علاجاتها.
- **`PatientPlanPage.tsx`:** محرر خطة العلاج. يسمح بإنشاء جلسات مستقبلية وإضافة علاجات لكل جلسة بطريقة مرنة.
- **`PatientDetailsPage.tsx`:** تعرض جميع معلومات المريض الأساسية والطبية في صفحة واحدة للقراءة فقط.
- **`PatientFinancialPage.tsx`:** تعرض كشف حساب كامل للمريض، يشمل جميع تكاليف العلاج والمدفوعات والرصيد المتبقي.
- **`PatientPhotosPage.tsx`:** معرض صور للمريض. يتيح رفع صور جديدة، تعديل التعليقات، حذف الصور، وعرضها بحجم كامل.
- **`PatientActivityLogPage.tsx`:** سجل مخصص يعرض فقط الأنشطة التي تمت على ملف هذا المريض تحديداً.

### 5.4 المكونات المشتركة (Shared Components - `src/components/`)
- **`Icons.tsx`:** مكتبة أيقونات SVG المستخدمة في جميع أنحاء التطبيق.
- **`LoadingSpinner.tsx`:** مؤشر تحميل دائري يظهر عند جلب البيانات.
- **`ThemeToggleButton.tsx`:** زر يستخدم في الـ Header لتبديل المظهر بين الفاتح والداكن.
- **`dashboards/`:** مكونات لوحات التحكم التي تعرض إحصائيات سريعة واختصارات بناءً على دور المستخدم.
- **`users/`:** كل ملف يمثل تبويبًا داخل صفحة `UsersPage` لإدارة فئة معينة من المستخدمين.

---

## 6. الخدمات و Hooks

### 6.1 الخدمات (`src/services/`)
- **`api.ts`:** يحتوي على جميع الدوال المسؤولة عن التواصل مع الخادم (API) لجلب البيانات وإرسالها.
- **`db.ts`:** يقوم بتهيئة قاعدة البيانات المحلية (IndexedDB) باستخدام مكتبة `Dexie`، ويحدد الجداول والمخططات.
- **`sync.ts`:** يحتوي على المنطق الخاص بمزامنة العمليات التي تمت أثناء عدم وجود اتصال بالإنترنت. يقوم بتخزين العمليات في `syncQueue` وإرسالها عند عودة الاتصال.
- **`touchSound.ts`:** يوفر دالة لتشغيل صوت نقرة خفيف عند تفاعل المستخدم مع الأزرار على الأجهزة المحمولة.

### 6.2 Hooks المخصصة (`src/hooks/`)
- **`useAuth.ts`:** يوفر `AuthContext` لإدارة حالة تسجيل دخول المستخدم (user object)، ويحتوي على دوال `login` و `logout`.
- **`useTheme.ts`:** يوفر `ThemeContext` لإدارة المظهر الحالي (light/dark) وتبديله.
- **`useAppSettings.ts`:** يوفر `AppSettingsContext` لإدارة الإعدادات العامة للتطبيق مثل اسم وشعار العيادة.

---

## 7. أنواع البيانات وحقولها (Data Types & Fields)

### أ. المستخدم (User)
- `id` (string): المعرف الفريد.
- `name` (string): الاسم الكامل.
- `email` (string): البريد الإلكتروني.
- `password` (string, optional): كلمة المرور.
- `role` (UserRole): نوع المستخدم.
- `specialty` (string, optional): تخصص الطبيب.
- `is_diagnosis_doctor` (boolean, optional): هل هو طبيب تشخيص.

### ب. المريض (Patient)
- `id` (string): المعرف الفريد.
- `code` (string): كود المريض.
- `name` (string): الاسم الكامل.
- `age` (number): العمر.
- `phone` (string): رقم الهاتف.
- `notes` (string, optional): ملاحظات عامة.
- `doctorIds` (string[]): معرفات الأطباء المسؤولين.
- `gender` (Gender): الجنس (ذكر/أنثى).
- `isSmoker`, `isPregnant` (boolean, optional).
- `drugAllergy`, `chronicDiseases` (string, optional).
- `createdAt` (string): تاريخ الإنشاء.
- `completed`, `payment_completed` (boolean, optional).

### ج. الجلسة (Session)
- `id` (string): المعرف الفريد.
- `patientId`, `doctorId` (string).
- `title`, `date`, `notes` (string).
- `treatments` (SessionTreatment[]): العلاجات.
- `completed` (boolean, optional).

### د. علاج ضمن جلسة (SessionTreatment)
- `instanceId` (string): المعرف الفريد للعلاج في الجلسة.
- `sessionPrice` (number): سعر العلاج في هذه الجلسة.
- `sessionNotes` (string, optional): ملاحظات.
- `completed` (boolean): هل تم التنفيذ.
- `treatmentDate` (string, optional).
- `additionalCosts` (number, optional).
- (يرث الحقول الأخرى من `Treatment`).

### هـ. العلاج الأساسي (Treatment)
- `id` (string): المعرف الفريد.
- `name` (string): اسم العلاج.
- `price` (number): السعر الأساسي.
- `notes` (string, optional).

### و. الموعد (Appointment)
- `id` (string): المعرف الفريد.
- `patientId`, `doctorId`, `createdBy` (string).
- `date`, `time`, `notes` (string).

### ز. الدفعة المالية (Payment)
- `id` (string): المعرف الفريد.
- `patientId` (string).
- `amount` (number).
- `date` (string).

### ح. صورة المريض (PatientPhoto)
- `id` (string): المعرف الفريد.
- `patientId` (string).
- `imageUrl`, `caption`, `date` (string).

### ط. جدول عمل الطبيب (DaySchedule)
- `id` (string, optional).
- `day` (number): يوم الأسبوع (0-6).
- `isWorkDay` (boolean).
- `startTime`, `endTime` (string).
- `doctorId` (string).

### ي. سجل النشاط (ActivityLog)
- `id` (string): المعرف الفريد.
- `patientId`, `userId`, `userName` (string).
- `actionType` (ActivityLogActionType): نوع الإجراء.
- `description`, `timestamp` (string).
